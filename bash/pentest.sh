#!/bin/bash
clear

# Check for Dependacies
type toilet >/dev/null 2>&1 || { sudo apt-get install -y toilet; exit 1; }

# Check for root
function rootcheck() {
if [[ $USER != "root" ]] ; then
                echo "Please Note: This script must be run as root!"
                exit 1
        fi
echo -e " Checking For Root or Sudo: ${g}PASSED${endc}"
}

#Menu Display

function menu() {
echo "	1. DNS check"
echo "	2. Nmap Ping Sweep"
echo "	3. MS SQL Instance Enum"
echo "	q. Quit"
echo "Choice: "
read choice
}

#DNS Scan function

function dns_scan() { 
echo "$(tput setaf 3)[*]$(tput sgr0) Enter the domain name"
read domain
dig $domain ANY +nostat +nocmd +nocomments > $output/$company/dns/dns.txt
echo "     "
echo "$(tput setaf 2)[*]$(tput sgr0) DNS scan output to DNS folder"
sleep 2
echo "   "
echo "$(tput setaf 3)[*]$(tput sgr0) Choose another option or Quit"
echo "   "
menu
}

#Nmap Ping sweep function
function ping_sweep() {
touch $output/$company/nmap/hostlist.txt
echo ">> Please enter IP/range"
        read ip_input
echo $ip_input >> $output/$company/hostlist.txt
echo "$(tput setaf 3)[+]$(tput sgr0) Running Ping sweep on $ip_input"
sleep 2
nmap -sP -iL $output/$company/nmap/hostlist.txt -oG $output/$company/nmap/pingscan > /dev/null
grep Up $output/$company/nmap/pingscan | awk '{print$2}' > $output/$company/nmap/ScanResult/uplist
grep Down $output/$company/nmap/pingscan | awk '{print$2}' > $output/$company/nmap/ScanResult/downlist
echo "     "
echo "$(tput setaf 2)[+]$(tput sgr0)Live hosts from '$ip_input'saved to /root/$company/nmap/"
echo "    "
sleep 2
menu
}

#MSSQL DB Instance Enumeration
function MSSQL(){
echo "$(tput setaf 3)[+]$(tput sgr0) Please enter target IP Address."
read sql_ip
echo "    "
echo "$(tput setaf 3)[+]$(tput sgr0) Test may take a few minutes to complete!"
nmap -sS --script=ms-sql-info $sql_ip >> $output/$company/nmap/db_enum.txt
echo "    "
echo "$(tput setaf 2)[+](tput sgr0) MS SQL Enumeration saved to $output/$company/nmap/"
}

rootcheck
toilet -f standard PenScan

echo "$(tput setaf 2)[*]$(tput sgr0) PenScan v1.0 by @InfoSecPS"
echo "Enter name of Company"
read company
echo "    "
echo "Where would you like to save '$company' files?"
read output
mkdir $output/$company
cd $output/$company
mkdir {dns,urls,nmap}
cd nmap
mkdir ScanResult
echo "$(tput setaf 2)[*]$(tput sgr0) Directories Created!"
echo "     "
sleep 2 
menu


if [ $choice == "1" ]
then 
dns_scan
fi

if [ $choice == "2" ]
then
ping_sweep
fi

if [ $choice == "3" ]
then
MSSQL
fi

if [ $choice == "q" ]
then
exit
fi


